import { useMemo } from 'react';
import { useContainerWidth } from './useContainerWidth';

const GRID_GUTTER_WIDTH = 14;
const ITEM_MIN_WIDTH = 302;

/**
 * Custom hook used to make sure that we enough room in a component to display
 * child cards (in product listings, editions, etc.)
 * based on the desired minimum width of the inner elements, and the theme's gutter width
 * @param {number} - maxCols - maximum desired number of columns
 * @param {number} - itemMinWidth - the minimum width of each child, if not theme default
 * @param {number} - gutter - the gutter width between each column, if not theme default
 * @returns {array} - Reference object and the number of columns
 */
export const useItemsGrid = (maxCols = 4, itemMinWidth = ITEM_MIN_WIDTH, gutter = GRID_GUTTER_WIDTH) => {
    const [containerRef, containerWidth] = useContainerWidth();
    const gridSettings = useMemo(() => {
        const indexes = [];
        for (let i = 2; i <= maxCols; i += 1) {
            indexes.push(i);
        }
        return indexes.map(columns => {
            const maxWidth = (columns * itemMinWidth) + ((columns - 1) * (gutter * 2));
            return {
                columns: columns - 1,
                maxWidth
            };
        });
    }, [itemMinWidth, gutter, maxCols]);
    const gridColumns = useMemo(() => {
        const appliedSetting = gridSettings.find(sizeSetting => (
            containerWidth < sizeSetting.maxWidth
        ));
        return (appliedSetting && appliedSetting.columns) || maxCols;
    }, [containerWidth, gridSettings, maxCols]);
    return [containerRef, gridColumns];
};
